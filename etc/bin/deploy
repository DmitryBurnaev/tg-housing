#!/bin/sh
set -e

export WORKING_DIR=/opt/tg-housing/

if [ "${DEPLOY_MODE}" != "CI" ]
  then
    echo "=== reading $(pwd)/.env file ==="
    export $(cat .env | grep -v ^# | xargs)
fi

echo "NEW DEPLOY"

echo "=== pulling image ${DOCKER_IMAGE_URL}:${DOCKER_IMAGE_TAG} ==="
docker pull ${DOCKER_IMAGE_URL}:${DOCKER_IMAGE_TAG}

echo "=== restarting service ==="
docker compose down
docker compose up -d
#systemctl service tg-housing restart

echo "=== clearing ==="
#echo y | docker image prune -a

echo "=== check status ==="
docker ps | grep "tg-housing"
#systemctl service tg-housing status
